#!/usr/bin/env bash

set -e

ORG_FILE="$1"

notify() {
    if command -v notify-send >/dev/null 2>&1; then
        notify-send "Org Tangle" "$1"
    fi
}

if [ -z "$ORG_FILE" ]; then
    echo "❌ Usage: autotangle path/to/file.org"
    notify-send "Usage: autotangle path/to/file.org"
    exit 1
fi

if [ ! -f "$ORG_FILE" ]; then
    echo "❌ File not found: $ORG_FILE"
    notify-send "File not found: $ORG_FILE"
    exit 1
fi

echo "⏳ Tangling: $ORG_FILE"
notify-send "Tangling: $ORG_FILE"

emacs --batch \
      --eval "(require 'org)" \
      --eval "(require 'ob-tangle)" \
      --eval "(org-babel-tangle-file \"$ORG_FILE\")"

echo "✅ Tangled successfully: $ORG_FILE"
notify-send "Tangle completed successfully"
